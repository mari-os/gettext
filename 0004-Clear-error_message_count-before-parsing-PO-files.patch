From ce4ba54dcd5b00903860ac9f4ae95cace109ea7e Mon Sep 17 00:00:00 2001
From: Daiki Ueno <ueno@gnu.org>
Date: Wed, 23 Oct 2013 18:31:20 +0900
Subject: [PATCH 4/4] Clear error_message_count before parsing PO files.

---
 gettext-tools/src/ChangeLog               | 9 +++++++++
 gettext-tools/src/read-catalog-abstract.c | 3 ++-
 2 files changed, 11 insertions(+), 1 deletion(-)

diff --git a/gettext-tools/src/ChangeLog b/gettext-tools/src/ChangeLog
index 3eb37a3..dd220df 100644
--- a/gettext-tools/src/ChangeLog
+++ b/gettext-tools/src/ChangeLog
@@ -1,3 +1,12 @@
+2013-10-23  Daiki Ueno  <ueno@gnu.org>
+
+	* read-catalog-abstract.c (catalog_reader_parse): Clear
+	error_message_count before parsing, rather than after.  The
+	variable may be > 0 before calling the PO parser, when xgettext
+	handles mutiple files.
+	Problem reported by Emil Wojak in
+	<https://lists.gnu.org/archive/html/bug-gettext/2013-10/msg00005.html>.
+
 2013-10-15  Peter Eisentraut  <peter_e@gmx.net>  (tiny change)
 
 	* msgl-check.c (check_header_entry): Adjust the default value of
diff --git a/gettext-tools/src/read-catalog-abstract.c b/gettext-tools/src/read-catalog-abstract.c
index cb713dc..d4e98ee 100644
--- a/gettext-tools/src/read-catalog-abstract.c
+++ b/gettext-tools/src/read-catalog-abstract.c
@@ -171,6 +171,8 @@ catalog_reader_parse (abstract_catalog_reader_ty *pop, FILE *fp,
                       const char *real_filename, const char *logical_filename,
                       catalog_input_format_ty input_syntax)
 {
+  error_message_count = 0;
+
   /* Parse the stream's content.  */
   parse_start (pop);
   input_syntax->parse (pop, fp, real_filename, logical_filename);
@@ -183,7 +185,6 @@ catalog_reader_parse (abstract_catalog_reader_ty *pop, FILE *fp,
                                     "found %d fatal errors",
                                     error_message_count),
                           error_message_count));
-  error_message_count = 0;
 }
 
 
-- 
1.8.4.3

